{% extends 'quotes/base.html' %}

{% block content %}
    {% if quote %}
        <div class="quote-container">
            <article class="quote">
                <p class="text">{{ quote.text }}</p>
                <p class="meta">‚Äî {{ quote.source.name }} (–≤–µ—Å: {{ quote.weight }})</p>
                <p class="meta">
                    –ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤: {{ quote.views }} |
                    –õ–∞–π–∫–∏: <span id="likes">{{ quote.likes }}</span> |
                    –î–∏–∑–ª–∞–π–∫–∏: <span id="dislikes">{{ quote.dislikes }}</span>
                </p>

                <form id="vote-form" method="post" action="{% url 'quotes:vote_quote' quote.pk %}">
                    {% csrf_token %}
                    <button type="button" data-action="like">üëç –õ–∞–π–∫</button>
                    <button type="button" data-action="dislike">üëé –î–∏–∑–ª–∞–π–∫</button>
                </form>
            </article>
        </div>

        <script>
            const form = document.getElementById('vote-form');
            const csrfToken = form.querySelector('input[name=csrfmiddlewaretoken]').value;

            document.querySelectorAll('#vote-form button').forEach(btn => {
                btn.addEventListener('click', function () {
                    const data = new FormData();
                    data.append('action', this.dataset.action);

                    fetch(form.action, {
                        method: 'POST',
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest',
                            'X-CSRFToken': csrfToken
                        },
                        body: data
                    })
                    .then(r => r.json())
                    .then(j => {
                        document.getElementById('likes').textContent = j.likes;
                        document.getElementById('dislikes').textContent = j.dislikes;
                    });
                });
            });
        </script>

    {% else %}
        <p>–¶–∏—Ç–∞—Ç –µ—â—ë –Ω–µ—Ç. <a href="{% url 'quotes:add_quote' %}">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é</a>.</p>
    {% endif %}

    
{% endblock %}
